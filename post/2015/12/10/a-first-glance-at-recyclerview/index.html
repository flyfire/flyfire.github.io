<!DOCTYPE html>
<html lang="zh-cn">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>A First Glance at Recyclerview - Solarex&#39;s Blog</title>
  <meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">


<meta name="author" content="Solarex" /><meta name="description" content="At this year’s Google I/O, Google released a preview to the upcoming Android version. The so called L Developer Preview. This is a very big improvement over previous releases and I really love that Google is doing this. I think we all benefit by this decision. As developers and as consumers alike!
Part of this preview are two new views: RecyclerView and CardView. This post gives you an introduction to the RecyclerView, it’s many internal classes and interfaces, how they interact and how you can use them." /><meta name="keywords" content="Android, Java, Kotlin" />






<meta name="generator" content="Hugo 0.110.0 with theme even" />


<link rel="canonical" href="https://flyfire.github.io/post/2015/12/10/a-first-glance-at-recyclerview/" />
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/manifest.json">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">

<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>

<link href="/sass/main.min.f92fd13721ddf72129410fd8250e73152cc6f2438082b6c0208dc24ee7c13fc4.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.css" integrity="sha256-7TyXnr2YU040zfSP+rEcz29ggW4j56/ujTPwjMzyqFY=" crossorigin="anonymous">


<meta property="og:title" content="A First Glance at Recyclerview" />
<meta property="og:description" content="At this year’s Google I/O, Google released a preview to the upcoming Android version. The so called L Developer Preview. This is a very big improvement over previous releases and I really love that Google is doing this. I think we all benefit by this decision. As developers and as consumers alike!
Part of this preview are two new views: RecyclerView and CardView. This post gives you an introduction to the RecyclerView, it’s many internal classes and interfaces, how they interact and how you can use them." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://flyfire.github.io/post/2015/12/10/a-first-glance-at-recyclerview/" /><meta property="article:section" content="post" />
<meta property="article:published_time" content="2015-12-10T00:00:00+00:00" />
<meta property="article:modified_time" content="2015-12-10T00:00:00+00:00" />
<meta itemprop="name" content="A First Glance at Recyclerview">
<meta itemprop="description" content="At this year’s Google I/O, Google released a preview to the upcoming Android version. The so called L Developer Preview. This is a very big improvement over previous releases and I really love that Google is doing this. I think we all benefit by this decision. As developers and as consumers alike!
Part of this preview are two new views: RecyclerView and CardView. This post gives you an introduction to the RecyclerView, it’s many internal classes and interfaces, how they interact and how you can use them."><meta itemprop="datePublished" content="2015-12-10T00:00:00+00:00" />
<meta itemprop="dateModified" content="2015-12-10T00:00:00+00:00" />
<meta itemprop="wordCount" content="3052">
<meta itemprop="keywords" content="" /><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="A First Glance at Recyclerview"/>
<meta name="twitter:description" content="At this year’s Google I/O, Google released a preview to the upcoming Android version. The so called L Developer Preview. This is a very big improvement over previous releases and I really love that Google is doing this. I think we all benefit by this decision. As developers and as consumers alike!
Part of this preview are two new views: RecyclerView and CardView. This post gives you an introduction to the RecyclerView, it’s many internal classes and interfaces, how they interact and how you can use them."/>

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->

</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/" class="logo">Solarex&#39;s Blog</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <a href="/">
        <li class="mobile-menu-item">Home</li>
      </a><a href="/post/">
        <li class="mobile-menu-item">Archives</li>
      </a><a href="/projects/">
        <li class="mobile-menu-item">Projects</li>
      </a><a href="/about/">
        <li class="mobile-menu-item">About</li>
      </a>
  </ul>

  


</nav>

  <div class="container" id="mobile-panel">
    <header id="header" class="header">
        <div class="logo-wrapper">
  <a href="/" class="logo">Solarex&#39;s Blog</a>
</div>





<nav class="site-navbar">
  <ul id="menu" class="menu">
    <li class="menu-item">
        <a class="menu-item-link" href="/">Home</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/post/">Archives</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/projects/">Projects</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/about/">About</a>
      </li>
  </ul>
</nav>

    </header>

    <main id="main" class="main">
      <div class="content-wrapper">
        <div id="content" class="content">
          <article class="post">
    
    <header class="post-header">
      <h1 class="post-title">A First Glance at Recyclerview</h1>

      <div class="post-meta">
        <span class="post-time"> 2015-12-10 </span>
        <div class="post-category">
            <a href="/categories/dev/"> dev </a>
            <a href="/categories/android/"> android  </a>
            </div>
          <span class="more-meta"> 约 3052 字 </span>
          <span class="more-meta"> 预计阅读 15 分钟 </span>
        <span id="busuanzi_container_page_pv" class="more-meta"> <span id="busuanzi_value_page_pv"><img src="/img/spinner.svg" alt="spinner.svg"/></span> 次阅读 </span>
      </div>
    </header>

    <div class="post-toc" id="post-toc">
  <h2 class="post-toc-title">文章目录</h2>
  <div class="post-toc-content always-active">
    <nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#sample-project">Sample project</a></li>
        <li><a href="#whats-with-this-odd-name-why-recyclerview">What’s with this odd name? Why RecyclerView?</a></li>
        <li><a href="#recyclerview-doesnt-care-about-visuals">RecyclerView doesn’t care about visuals</a></li>
        <li><a href="#viewholder">ViewHolder</a></li>
        <li><a href="#recyclerviewadapter">RecyclerView.Adapter</a></li>
        <li><a href="#recyclerviewlayoutmanager">RecyclerView.LayoutManager</a>
          <ul>
            <li><a href="#linearlayoutmanager">LinearlayoutManager</a></li>
          </ul>
        </li>
        <li><a href="#recyclerviewitemdecoration">RecyclerView.ItemDecoration</a></li>
        <li><a href="#recyclerviewitemanimator">RecyclerView.ItemAnimator</a></li>
        <li><a href="#listeners">Listeners</a></li>
        <li><a href="#combining-all-classes">Combining all classes</a></li>
        <li><a href="#gradle-integration">Gradle integration</a></li>
        <li><a href="#is-that-the-final-api">Is that the final API?</a></li>
        <li><a href="#reference">reference</a></li>
      </ul>
    </li>
  </ul>
</nav>
  </div>
</div>
    <div class="post-content">
      <p>At this year’s Google I/O, Google released a preview to the upcoming Android version. The so called L Developer Preview. This is a very big improvement over previous releases and I really love that Google is doing this. I think we all benefit by this decision. As developers and as consumers alike!</p>
<p>Part of this preview are two new views: RecyclerView and CardView. This post gives you an introduction to the RecyclerView, it’s many internal classes and interfaces, how they interact and how you can use them.</p>
<p>Let me start with the good news : RecyclerView is part of the support library. So you can use it right now. Ok: You can use it as soon as the final support lib accompanying the L release gets released. So better to familiarize yourself with it right away.</p>
<h2 id="sample-project">Sample project</h2>
<p>The screenshots and the video at the end of the post show the sample project for this post in action. You can find the <a href="https://github.com/writtmeyer/recyclerviewdemo">source of this sample at github</a>. Keep in mind that the RecyclerView API is not yet finalized. Google might still change things that could break the sample when they release the final version of Android L.</p>
<h2 id="whats-with-this-odd-name-why-recyclerview">What’s with this odd name? Why RecyclerView?</h2>
<p>This is how Google describes RecyclerView in the API documentation of the L preview release:</p>
<pre><code>A flexible view for providing a limited window into a large data set.
</code></pre>
<p>So RecyclerView is the appropriate view to use when you have multiple items of the same type and it’s very likely that your user’s device cannot present all of those items at once. Possible examples are contacts, customers, audio files and so on. The user has to scroll up and down to see more items and that’s when the recycling and reuse comes into play. As soon as a user scrolls a currently visible item out of view, this item’s view can be recycled and reused whenever a new item comes into view.</p>
<p>The following screenshots of the sample app illustrate this. On the left is the sample app after the initial start. When you scroll the view up, some views become eligible for recycling. The red area on the right screenshot, for example, highlights two invisible views. The recycler can now put these views into a list of candidates to be reused should a new view be necessary.</p>
<center><img src="/images/a_first_glance_of_recyclerview_recycling_of_views.png" width="624" height="474"></center>
<p>Recycling of views is a very useful approach. It saves CPU resources in that you do not have to inflate new views all the time and it saves memory in that it doesn’t keep plenty of invisible views around.</p>
<p>Now, you might say: That’s nothing new. And you’re right! We had that with ListView for a very long time. The concept of recycling views itself it not new. But while you previously had a ListView where the appearance, recycling and everything was tightly coupled, Google now follows a much better, a much more flexible approach with the new RecyclerView. I really like the approach Google has taken here!</p>
<h2 id="recyclerview-doesnt-care-about-visuals">RecyclerView doesn’t care about visuals</h2>
<p>Here’s the thing: While with Listview we had tight coupling, Google now uses an approach where the RecyclerView itself doesn’t care about visuals at all. It doesn’t care about placing the elements at the right place, it doesn’t care about separating any items and not about the look of each individual item either. To exaggerate a bit: All RecyclerView does, is recycle stuff. Hence the name.</p>
<p>Anything that has to do with layout, drawing and so on, that is anything that has to do with how your data set is presented, is delegated to pluggable classes. That makes the new RecyclerView API extremely flexible. You want another layout? Plug in another LayoutManager. You want different animations? Plug in an ItemAnimator. And so on.</p>
<p>Here’s the list of the most important classes that RecyclerView makes use of to present the data. All these classes are inner classes of the RecyclerView:</p>
<center><img src="/images/recyclerview_api.png" width="823" height="427" /></center>
<p>In the next paragraphs I will briefly describe what each class or interface is about and how RecyclerView uses it. In future posts I will revisit some of these classes, write about them in detail and show you how to customize them for your project’s needs.</p>
<h2 id="viewholder">ViewHolder</h2>
<p>ViewHolders are basically caches of your View objects. The Android team has been recommending using the ViewHolder pattern for a very long time, but they never actually enforced the use of it. Now with the new Adapter you finally have to use this pattern.</p>
<p>It’s a bit weird that Google waited so long to enforce the usage of the ViewHolder pattern, but better late than never. If you do not know about the ViewHolder pattern, have a look at this <a href="http://developer.android.com/training/improving-layouts/smooth-scrolling.html">Android training session</a>. It uses the old Adapter, but the pattern itself hasn’t changed.</p>
<p>Also searching for ViewHolder should yield plenty of hits to further blog posts. For example this post by <a href="http://antoine-merle.com/listview-optimisations-part-1-the-viewholder/">Antoine Merle about ListView optimizations</a>.</p>
<p>One thing that is specific to any RecyclerView.ViewHolder subclass is that you can always access the root view of your ViewHolder by accessing the public member itemView. So there’s no need to store that within your ViewHolder subclass.</p>
<p>And should you decide to override toString() have a look at the base class. Its toString() implementation prints some useful information you should consider to use for your log messages as well.</p>
<p>Here’s the code for the ViewHolder of the sample project. The ViewHolder is an inner class of the sample project’s Adapter:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">final</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">ListItemViewHolder</span> <span class="kd">extends</span> <span class="n">RecyclerView</span><span class="o">.</span><span class="na">ViewHolder</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">   <span class="n">TextView</span> <span class="n">label</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">   <span class="n">TextView</span> <span class="n">dateTime</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">   <span class="kd">public</span> <span class="nf">ListItemViewHolder</span><span class="o">(</span><span class="n">View</span> <span class="n">itemView</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">      <span class="kd">super</span><span class="o">(</span><span class="n">itemView</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">      <span class="n">label</span> <span class="o">=</span> <span class="o">(</span><span class="n">TextView</span><span class="o">)</span> <span class="n">itemView</span><span class="o">.</span><span class="na">findViewById</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">txt_label_item</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">      <span class="n">dateTime</span> <span class="o">=</span> <span class="o">(</span><span class="n">TextView</span><span class="o">)</span> <span class="n">itemView</span><span class="o">.</span><span class="na">findViewById</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">txt_date_time</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">   <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="recyclerviewadapter">RecyclerView.Adapter</h2>
<p>Adapters fulfill two roles: They provide access to the underlying data set and they are responsible for creating the correct layout for individual items. Adapters always were part of Android and were used in many places. ListView, AutoCompleteTextView, Spinner and more all made use of adapters. All those classes inherit from AdapterView. But not so RecyclerView.</p>
<p>For the new RecyclerView Google has decided to replace the old Adapter interface with a new <strong>RecyclerView.Adapter</strong> base class. So say good bye to things like SimpleCursorAdapter, ArrayAdapter and the like. At least in their current incarnation.</p>
<p>Currently there is no default implementation of RecyclerView.Adapter available. Google might add some later on, but I wouldn’t bet on this. For Animations to work properly, cursors and arrays aren’t the best fit, so porting the current Adapter implementations might not make too much sense.</p>
<p>Since RecyclerView.Adapter is abstract you will have to implement these three methods:</p>
<ul>
<li><code>public VH onCreateViewHolder(ViewGroup parent, int viewType)</code></li>
<li><code>public void onBindViewHolder(VH holder, int position)</code></li>
<li><code>public int getItemCount()</code></li>
</ul>
<p>The VH in the method signatures above is the generic type parameter. You specify the concrete type to use when you subclass the RecyclerView.Adapter. You can see this in line 3 of the next code sample.</p>
<p>The most basic adapter for the sample layout looks like this:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">RecyclerViewDemoAdapter</span> <span class="kd">extends</span>
</span></span><span class="line"><span class="cl">        <span class="n">RecyclerView</span><span class="o">.</span><span class="na">Adapter</span>
</span></span><span class="line"><span class="cl">        <span class="o">&lt;</span><span class="n">RecyclerViewDemoAdapter</span><span class="o">.</span><span class="na">ListItemViewHolder</span><span class="o">&gt;</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">DemoModel</span><span class="o">&gt;</span> <span class="n">items</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">RecyclerViewDemoAdapter</span><span class="o">(</span><span class="n">List</span><span class="o">&lt;</span><span class="n">DemoModel</span><span class="o">&gt;</span> <span class="n">modelData</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="o">(</span><span class="n">modelData</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">throw</span> <span class="k">new</span> <span class="n">IllegalArgumentException</span><span class="o">(</span>
</span></span><span class="line"><span class="cl">                  <span class="s">&#34;modelData must not be null&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">        <span class="k">this</span><span class="o">.</span><span class="na">items</span> <span class="o">=</span> <span class="n">modelData</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nd">@Override</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="n">ListItemViewHolder</span> <span class="nf">onCreateViewHolder</span><span class="o">(</span>
</span></span><span class="line"><span class="cl">            <span class="n">ViewGroup</span> <span class="n">viewGroup</span><span class="o">,</span> <span class="kt">int</span> <span class="n">viewType</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">View</span> <span class="n">itemView</span> <span class="o">=</span> <span class="n">LayoutInflater</span><span class="o">.</span>
</span></span><span class="line"><span class="cl">                <span class="nf">from</span><span class="o">(</span><span class="n">viewGroup</span><span class="o">.</span><span class="na">getContext</span><span class="o">()).</span>
</span></span><span class="line"><span class="cl">                <span class="n">inflate</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">layout</span><span class="o">.</span><span class="na">item_demo_01</span><span class="o">,</span>
</span></span><span class="line"><span class="cl">                        <span class="n">viewGroup</span><span class="o">,</span>
</span></span><span class="line"><span class="cl">                        <span class="kc">false</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="k">new</span> <span class="n">ListItemViewHolder</span><span class="o">(</span><span class="n">itemView</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nd">@Override</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onBindViewHolder</span><span class="o">(</span>
</span></span><span class="line"><span class="cl">            <span class="n">ListItemViewHolder</span> <span class="n">viewHolder</span><span class="o">,</span> <span class="kt">int</span> <span class="n">position</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">DemoModel</span> <span class="n">model</span> <span class="o">=</span> <span class="n">items</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">position</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="n">viewHolder</span><span class="o">.</span><span class="na">label</span><span class="o">.</span><span class="na">setText</span><span class="o">(</span><span class="n">model</span><span class="o">.</span><span class="na">label</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="n">String</span> <span class="n">dateStr</span> <span class="o">=</span> <span class="n">DateUtils</span><span class="o">.</span><span class="na">formatDateTime</span><span class="o">(</span>
</span></span><span class="line"><span class="cl">                <span class="n">viewHolder</span><span class="o">.</span><span class="na">label</span><span class="o">.</span><span class="na">getContext</span><span class="o">(),</span>
</span></span><span class="line"><span class="cl">                <span class="n">model</span><span class="o">.</span><span class="na">dateTime</span><span class="o">.</span><span class="na">getTime</span><span class="o">(),</span>
</span></span><span class="line"><span class="cl">                <span class="n">DateUtils</span><span class="o">.</span><span class="na">FORMAT_ABBREV_ALL</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="n">viewHolder</span><span class="o">.</span><span class="na">dateTime</span><span class="o">.</span><span class="na">setText</span><span class="o">(</span><span class="n">dateStr</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nd">@Override</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">getItemCount</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">items</span><span class="o">.</span><span class="na">size</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kd">final</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">ListItemViewHolder</span>
</span></span><span class="line"><span class="cl">           <span class="kd">extends</span> <span class="n">RecyclerView</span><span class="o">.</span><span class="na">ViewHolder</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// … shown above in the ViewHolder section
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="recyclerviewlayoutmanager">RecyclerView.LayoutManager</h2>
<p>The <code>LayoutManager</code> is probably the most interesting part of the <code>RecyclerView</code>. This class is responsible for the layout of all child views. There is one default implementation available: <code>LinearLayoutManager</code> which you can use for vertical as well as horizontal lists.</p>
<p>You have to set a <code>LayoutManager</code> for your <code>RecyclerView</code> otherwise you will see an exception at Runtime:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">08-01 05:00:00.000  <span class="m">2453</span>  <span class="m">2453</span> E AndroidRuntime: java.lang.NullPointerException: Attempt to invoke virtual method ‘void android.support.v7.widget.RecyclerView<span class="nv">$LayoutManager</span>.onMeasure<span class="o">(</span>android.support.v7.widget.RecyclerView<span class="nv">$Recycler</span>, android.support.v7.widget.RecyclerView<span class="nv">$State</span>, int, int<span class="o">)</span>’ on a null object reference
</span></span><span class="line"><span class="cl">08-01 05:00:00.000  <span class="m">2453</span>  <span class="m">2453</span> E AndroidRuntime: 	at android.support.v7.widget.RecyclerView.onMeasure<span class="o">(</span>RecyclerView.java:1310<span class="o">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Only one method of LayoutManager is currently abstract:</p>
<ul>
<li><code>public LayoutParams generateDefaultLayoutParams()</code></li>
</ul>
<p>But there is another one where the code states that you should overrride it since it’s soon going to be abstract:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span> <span class="kt">void</span> <span class="nf">scrollToPosition</span><span class="o">(</span><span class="kt">int</span> <span class="n">position</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">   <span class="k">if</span> <span class="o">(</span><span class="n">DEBUG</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">      <span class="n">Log</span><span class="o">.</span><span class="na">e</span><span class="o">(</span><span class="n">TAG</span><span class="o">,</span> <span class="s">&#34;You MUST implement scrollToPosition. It will soon become abstract&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">   <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>That’s very weird! Why not make it abstract right away? Anyway: Better you override this one to be on the safe side for when Google releases the final version of L.</p>
<p>But only overriding those two methods won’t get you very far. After all the <strong>LayoutManager</strong> is responsible for positioning the items you want to display. Thus you have to override <code>onLayoutChildren()</code> as well.</p>
<p>This method also contains a log statement stating “You must override onLayoutChildren(Recycler recycler, State state)”. Ok, then make it abstract :-) Luckily there’s still plenty (?) of time to change that into a proper abstract method for the final release of L. We all make mistakes. After all, <a href="http://www.grokkingandroid.com/tag/mistakes/">my “Stupid stuff devs make” series</a> is all about blunders that I made. So don’t get me wrong. No hard feelings here!</p>
<h3 id="linearlayoutmanager">LinearlayoutManager</h3>
<p>The LinearLayoutManager is currently the only default implementation of LayoutManager. You can use this class to create either vertical or horizontal lists.</p>
<p>The implementation of LinearLayoutManager is rather complex and I only had a look at some key aspects. I will return to this implementation in my post about custom LayoutManagers.</p>
<p>To use the LinearLayoutManager you simply have to instantiate it, tell it which orientation to use and you are done:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">LinearLayoutManager</span> <span class="n">layoutManager</span> <span class="o">=</span> <span class="k">new</span> <span class="n">LinearLayoutManager</span><span class="o">(</span><span class="n">context</span><span class="o">);</span>
</span></span><span class="line"><span class="cl"><span class="n">layoutManager</span><span class="o">.</span><span class="na">setOrientation</span><span class="o">(</span><span class="n">LinearLayoutManager</span><span class="o">.</span><span class="na">VERTICAL</span><span class="o">);</span>
</span></span><span class="line"><span class="cl"><span class="n">layoutManager</span><span class="o">.</span><span class="na">scrollToPosition</span><span class="o">(</span><span class="n">currPos</span><span class="o">);</span>
</span></span><span class="line"><span class="cl"><span class="n">recyclerView</span><span class="o">.</span><span class="na">setLayoutManager</span><span class="o">(</span><span class="n">layoutManager</span><span class="o">);</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>LinearLayoutManager also offers some methods to find out about the first and last items currently on screen:</p>
<ul>
<li><code>findFirstVisibleItemPosition()</code></li>
<li><code>findFirstCompletelyVisibleItemPosition()</code></li>
<li><code>findLastVisibleItemPosition()</code></li>
<li><code>findLastCompletelyVisibleItemPosition()</code></li>
</ul>
<p>Surprisingly these methods are not part of the source code in the SDK folder, but you can use them as they are part of the binaries. As I cannot imagine those being removed, I’m sure you’ll find these in the final L release as well.</p>
<p>Other methods help you get the orientation of the layout or the current scroll state. Others will compute the scroll offset. And finally you can reverse the ordering of the items.</p>
<p>Since I’m going to write an extra post about LayoutManagers this should suffice for now.</p>
<h2 id="recyclerviewitemdecoration">RecyclerView.ItemDecoration</h2>
<p>With an ItemDecoration you can add an offset to each item and modify the item so that items are separated from each other, highlighted or, well, decorated.</p>
<p>You do not have to use an ItemDecoration. If, for example, you use a CardView for each item, there’s no need for an ItemDecoration.</p>
<p>On the other hand you can add as many ItemDecorations as you like. The RecyclerView simply iterates over all ItemDecorations and calls the respective drawing methods for each of them in the order of the decoration chain.</p>
<p>The abstract base class contains these three methods:</p>
<ul>
<li><code>public void onDraw(Canvas c, RecyclerView parent)</code></li>
<li><code>public void onDrawOver(Canvas c, RecyclerView parent)</code></li>
<li><code>public void getItemOffsets(Rect outRect, int itemPosition, RecyclerView parent)</code></li>
</ul>
<p>Anything you paint in <code>onDraw()</code> might be hidden by the content of the item views but anything that you paint in <code>onDrawOver()</code> is drawn on top of the items. If you simply create a bigger offset and, for example, use this offset to paint dividers, this of course is of no importance. But if you really want to add decorations, you have to use <code>onDrawOver()</code>.</p>
<p>The <code>LayoutManager</code> calls the <code>getItemOffset()</code> method during the measurement phase to calculate the correct size of each item’s views. The <code>outRect</code> parameter might look a bit odd at first. Why not use a return value instead? But it really makes a lot of sense, since this allows <code>RecyclerView</code> to reuse one <code>Rect</code> object for all children and thus save resources. Not necessarily nice — but efficient.</p>
<p>One thing I didn’t expect considering the name of the class is that the <code>onDraw()/onDrawOver()</code> methods are not called for each item, but just once for every draw operation of the <code>RecyclerView</code>. You have to iterate over all child views of the <code>RecyclerView</code> yourself.</p>
<p>I will explain this in more detail in a follow-up post about writing your own <code>ItemDecorations</code>.</p>
<h2 id="recyclerviewitemanimator">RecyclerView.ItemAnimator</h2>
<p>The <code>ItemAnimator</code> class helps the <code>RecyclerView</code> with animating individual items. <code>ItemAnimators</code> deal with three events:</p>
<ul>
<li>An item gets added to the data set</li>
<li>An item gets removed from the data set</li>
<li>An item moves as a result of one or more of the previous two operations</li>
</ul>
<p>Luckily there exists a default implementation aptly named <code>DefaultItemAnimator</code>. If you do not set a custom <code>ItemAnimator</code>, <code>RecyclerView</code> uses an instance of <code>DefaultItemAnimator</code>.</p>
<p>Obviously for animations to work, Android needs to know about changes to the dataset. For this Android needs the support of your adapter. In earlier versions of Android you would call <code>notifyDataSetChanged()</code> whenever changes occured, this is no longer appropriate. This method triggers a complete redraw of all (visible) children at once without any animation. To see animations you have to use more specific methods.</p>
<p>The <code>RecyclerView.Adapter</code> class contains plenty of <code>notifyXyz()</code> methods. The two most specific are:</p>
<ul>
<li><code>public final void notifyItemInserted(int position)</code></li>
<li><code>public final void notifyItemRemoved(int position)</code></li>
</ul>
<p>The following video shows the result of an addition as well as a removal of an item in the sample app:</p>
<center><video width="800" height="1600" controls><source src="/files/a_first_glance_at_recyclerview_recyclerview_animation.mp4" type="video/mp4"></video></center>
<h2 id="listeners">Listeners</h2>
<p>RecyclerView also offers some rather generic listeners. Once again you can safely forget everything you used to use up to now. There is no OnItemClickListener or OnItemLongClickListener. But you can use an RecyclerView.OnItemTouchListener in combination with gesture detection to identify those events. A bit more work and more code to achieve the same result. I still hope for Google to add those Listeners in the final release. But whether those Listeners will be added is as an open question.</p>
<h2 id="combining-all-classes">Combining all classes</h2>
<p>You combine the classes either in a fragment or an activity. For the sake of simplicity my sample app uses activities only.</p>
<p>First of all here’s the layout file containing the RecyclerView:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-xml" data-lang="xml"><span class="line"><span class="cl"><span class="nt">&lt;RelativeLayout</span> <span class="na">xmlns:android=</span><span class="s">&#34;http://schemas.android.com/apk/res/android&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="na">xmlns:tools=</span><span class="s">&#34;http://schemas.android.com/tools&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="na">android:layout_width=</span><span class="s">&#34;match_parent&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="na">android:layout_height=</span><span class="s">&#34;match_parent&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="na">android:paddingLeft=</span><span class="s">&#34;@dimen/activity_horizontal_margin&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="na">android:paddingRight=</span><span class="s">&#34;@dimen/activity_horizontal_margin&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="na">android:paddingTop=</span><span class="s">&#34;@dimen/activity_vertical_margin&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="na">android:paddingBottom=</span><span class="s">&#34;@dimen/activity_vertical_margin&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="na">tools:context=</span><span class="s">&#34;.RecyclerViewDemoActivity&#34;</span><span class="nt">&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;android.support.v7.widget.RecyclerView</span>
</span></span><span class="line"><span class="cl">        <span class="na">android:id=</span><span class="s">&#34;@+id/recyclerView&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="na">android:layout_width=</span><span class="s">&#34;match_parent&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="na">android:layout_height=</span><span class="s">&#34;match_parent&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="na">tools:context=</span><span class="s">&#34;.MainActivity&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="na">tools:listitem=</span><span class="s">&#34;@layout/item_demo_01&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;ImageButton</span>
</span></span><span class="line"><span class="cl">        <span class="na">android:id=</span><span class="s">&#34;@+id/fab_add&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="na">android:layout_alignParentRight=</span><span class="s">&#34;true&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="na">android:layout_alignParentBottom=</span><span class="s">&#34;true&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="na">android:layout_width=</span><span class="s">&#34;@dimen/fab_size&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="na">android:layout_height=</span><span class="s">&#34;@dimen/fab_size&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="na">android:layout_gravity=</span><span class="s">&#34;bottom|right&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="na">android:layout_marginRight=</span><span class="s">&#34;16dp&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="na">android:layout_marginBottom=</span><span class="s">&#34;16dp&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="na">android:background=</span><span class="s">&#34;@drawable/ripple&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="na">android:stateListAnimator=</span><span class="s">&#34;@anim/anim&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="na">android:src=</span><span class="s">&#34;@drawable/ic_action_add&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="na">android:elevation=</span><span class="s">&#34;1dp&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;/RelativeLayout&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>As you can see, nothing special here. You do not define the orientation or stuff like that on the RecyclerView. Actually RecyclerView itself makes no use of the attributes, it passes them on to the parent (which is ViewGroup) and that’s it.</p>
<p>There is one place within RecyclerView where an AttributeSet is used and that is in the <code>generateLayoutParams()</code> method:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@Override</span>
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="n">ViewGroup</span><span class="o">.</span><span class="na">LayoutParams</span> <span class="nf">generateLayoutParams</span><span class="o">(</span><span class="n">AttributeSet</span> <span class="n">attrs</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">   <span class="k">if</span> <span class="o">(</span><span class="n">mLayout</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">      <span class="k">throw</span> <span class="k">new</span> <span class="n">IllegalStateException</span><span class="o">(</span><span class="s">&#34;RecyclerView has no LayoutManager&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">   <span class="o">}</span>
</span></span><span class="line"><span class="cl">   <span class="k">return</span> <span class="n">mLayout</span><span class="o">.</span><span class="na">generateLayoutParams</span><span class="o">(</span><span class="n">getContext</span><span class="o">(),</span> <span class="n">attrs</span><span class="o">);</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>In this snippet the RecyclerView passes the AttributeSet on to the LayoutManager.</p>
<p>The Java code is also pretty simple:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">setContentView</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">layout</span><span class="o">.</span><span class="na">activity_recyclerview_demo</span><span class="o">);</span>
</span></span><span class="line"><span class="cl"><span class="n">recyclerView</span> <span class="o">=</span> <span class="o">(</span><span class="n">RecyclerView</span><span class="o">)</span> <span class="n">findViewById</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">recyclerView</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">LinearLayoutManager</span> <span class="n">layoutManager</span> <span class="o">=</span> <span class="k">new</span> <span class="n">LinearLayoutManager</span><span class="o">(</span><span class="k">this</span><span class="o">);</span>
</span></span><span class="line"><span class="cl"><span class="n">layoutManager</span><span class="o">.</span><span class="na">setOrientation</span><span class="o">(</span><span class="n">LinearLayoutManager</span><span class="o">.</span><span class="na">VERTICAL</span><span class="o">);</span>
</span></span><span class="line"><span class="cl"><span class="n">layoutManager</span><span class="o">.</span><span class="na">scrollToPosition</span><span class="o">(</span><span class="mi">0</span><span class="o">);</span>
</span></span><span class="line"><span class="cl"><span class="n">recyclerView</span><span class="o">.</span><span class="na">setLayoutManager</span><span class="o">(</span><span class="n">layoutManager</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// allows for optimizations if all item views are of the same size:
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">recyclerView</span><span class="o">.</span><span class="na">setHasFixedSize</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// For the sake of simplicity I misused the Application subclass as a DAO
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">List</span><span class="o">&lt;</span><span class="n">DemoModel</span><span class="o">&gt;</span> <span class="n">items</span> <span class="o">=</span> <span class="n">RecyclerViewDemoApp</span><span class="o">.</span><span class="na">getDemoData</span><span class="o">();</span>
</span></span><span class="line"><span class="cl"><span class="n">adapter</span> <span class="o">=</span> <span class="k">new</span> <span class="n">RecyclerViewDemoAdapter</span><span class="o">(</span><span class="n">items</span><span class="o">);</span>
</span></span><span class="line"><span class="cl"><span class="n">recyclerView</span><span class="o">.</span><span class="na">setAdapter</span><span class="o">(</span><span class="n">adapter</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">RecyclerView</span><span class="o">.</span><span class="na">ItemDecoration</span> <span class="n">itemDecoration</span> <span class="o">=</span>
</span></span><span class="line"><span class="cl">        <span class="k">new</span> <span class="n">DividerItemDecoration</span><span class="o">(</span><span class="k">this</span><span class="o">,</span> <span class="n">DividerItemDecoration</span><span class="o">.</span><span class="na">VERTICAL_LIST</span><span class="o">);</span>
</span></span><span class="line"><span class="cl"><span class="n">recyclerView</span><span class="o">.</span><span class="na">addItemDecoration</span><span class="o">(</span><span class="n">itemDecoration</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// this is the default;
</span></span></span><span class="line"><span class="cl"><span class="c1">// this call is actually only necessary with custom ItemAnimators
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">recyclerView</span><span class="o">.</span><span class="na">setItemAnimator</span><span class="o">(</span><span class="k">new</span> <span class="n">DefaultItemAnimator</span><span class="o">());</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// onClickDetection is done in this Activity’s OnItemTouchListener
</span></span></span><span class="line"><span class="cl"><span class="c1">// with the help of a GestureDetector;
</span></span></span><span class="line"><span class="cl"><span class="c1">// Tip by Ian Lake on G+ in a comment to this post:
</span></span></span><span class="line"><span class="cl"><span class="c1">// https://plus.google.com/+LucasRocha/posts/37U8GWtYxDE
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">recyclerView</span><span class="o">.</span><span class="na">addOnItemTouchListener</span><span class="o">(</span><span class="k">this</span><span class="o">);</span>
</span></span><span class="line"><span class="cl"><span class="n">gesturedetector</span> <span class="o">=</span>
</span></span><span class="line"><span class="cl">        <span class="k">new</span> <span class="n">GestureDetectorCompat</span><span class="o">(</span><span class="k">this</span><span class="o">,</span> <span class="k">new</span> <span class="n">RecyclerViewDemoOnGestureListener</span><span class="o">());</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Connecting all those elements together roughly consists of these steps:</p>
<ul>
<li>Get a reference to your RecyclerView</li>
<li>Create a LayoutManager and add it</li>
<li>Create an Adapter and add it</li>
<li>Create zero or more ItemDecorations as needed and add them</li>
<li>Create an ItemAnimator if needed and add it</li>
<li>Create zero or more listeners as needed and add them</li>
</ul>
<p>All in all about 30 lines of code.</p>
<p>Now of course this is misleading. That’s only the glue code. The really interesting stuff is in RecyclerView&rsquo;s many inner classes which you can subclass and tweak to your needs. That’s where the real work is done.</p>
<p>But the separation of concerns Google created helps you stick to one task within one implementation and it should make reuse easier to achieve. That’s why I like RecyclerView and its ecosystem. I’m not afraid to criticize big G, but that’s well done, Google!</p>
<h2 id="gradle-integration">Gradle integration</h2>
<p>To use RecyclerView you have to add it to your gradle file. Adding the support library alone is not enough:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-groovy" data-lang="groovy"><span class="line"><span class="cl"><span class="n">dependencies</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">   <span class="c1">//…
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>   <span class="n">compile</span> <span class="err">‘</span><span class="n">com</span><span class="o">.</span><span class="na">android</span><span class="o">.</span><span class="na">support</span><span class="o">:</span><span class="n">recyclerview</span><span class="o">-</span><span class="nl">v7:</span><span class="o">+</span><span class="err">’</span>
</span></span><span class="line"><span class="cl">   <span class="c1">//…
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="o">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="is-that-the-final-api">Is that the final API?</h2>
<p>Of course I do not know if the concrete implementations that the preview contains will be in the final release of Android L. But I guess so. And I expect some additions as well as minor changes to the API, based on bug reports and developer feedback.</p>
<p>Google itself gives one hint in the current API documentation about more stuff to come. The documentation for the RecyclerView.LayoutManager class contains this nugget:</p>
<pre><code>Several stock layout managers are provided for general use.
</code></pre>
<p>So we can expect more LayoutManagers. Which, of course, is good. Furthermore I expect at least one default ItemDecoration as well. After all the support library’s sample project contains a DividerItemDecoration, which works well with the LinearLayoutManager.</p>
<p>I’m more skeptical about adapters. While an ArrayAdapter (or better yet, ListAdapter) is very well possible, I am more doubtful about a CursorAdapter since cursors do not lend themself easily to the new addition and removal notifications within the Adapter.</p>
<h2 id="reference">reference</h2>
<ul>
<li><a href="http://www.grokkingandroid.com/first-glance-androids-recyclerview/">A First Glance at Android’s RecyclerView</a></li>
<li><a href="http://lucasr.org/2014/07/31/the-new-twowayview/">The new TwoWayView</a></li>
</ul>

    </div>

    <div class="post-copyright">
  <p class="copyright-item">
    <span class="item-title">文章作者</span>
    <span class="item-content">Solarex</span>
  </p>
  <p class="copyright-item">
    <span class="item-title">上次更新</span>
    <span class="item-content">
        2015-12-10
        
    </span>
  </p>
  
  <p class="copyright-item">
    <span class="item-title">许可协议</span>
    <span class="item-content"><a rel="license noopener" href="https://creativecommons.org/licenses/by-nc-nd/4.0/" targ    et="_blank">CC BY-NC-ND 4.0</a></span>
  </p>
</div>
<div class="post-reward">
  <input type="checkbox" name="reward" id="reward" hidden />
  <label class="reward-button" for="reward">赞赏支持</label>
  <div class="qr-code">
    
    <label class="qr-code-image" for="reward">
        <img class="image" src="/images/wechatpay.png">
        <span>微信打赏</span>
      </label>
    <label class="qr-code-image" for="reward">
        <img class="image" src="/images/alipay.png">
        <span>支付宝打赏</span>
      </label>
  </div>
</div><footer class="post-footer">
      
      <nav class="post-nav">
        <a class="prev" href="/post/2016/01/10/building-a-recyclerview-layoutmanager-part-i/">
            <i class="iconfont icon-left"></i>
            <span class="prev-text nav-default">Building a Recyclerview Layoutmanager Part I</span>
            <span class="prev-text nav-mobile">上一篇</span>
          </a>
        <a class="next" href="/post/2015/11/23/android-starting-window/">
            <span class="next-text nav-default">Android Starting Window</span>
            <span class="next-text nav-mobile">下一篇</span>
            <i class="iconfont icon-right"></i>
          </a>
      </nav>
    </footer>
  </article>
        </div>
        <div id="disqus_thread"></div>
    <script type="text/javascript">
    (function() {
      
      
      if (window.location.hostname === 'localhost') return;

      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      var disqus_shortname = 'solarex-blog';
      dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>

  

  

      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="social-links">
      <a href="mailto:rh.hou.work@email.com" class="iconfont icon-email" title="email"></a>
      <a href="https://stackoverflow.com/users/2573305/user2573305" class="iconfont icon-stack-overflow" title="stack-overflow"></a>
      <a href="https://twitter.com/solarexcn" class="iconfont icon-twitter" title="twitter"></a>
      <a href="https://github.com/flyfire" class="iconfont icon-github" title="github"></a>
      <a href="https://weibo.com/solarex" class="iconfont icon-weibo" title="weibo"></a>
      <a href="https://www.zhihu.com/people/solarex" class="iconfont icon-zhihu" title="zhihu"></a>
      <a href="https://space.bilibili.com/8934511" class="iconfont icon-bilibili" title="bilibili"></a>
      <a href="https://www.douban.com/people/solarexh/" class="iconfont icon-douban" title="douban"></a>
  <a href="https://flyfire.github.io/index.xml" type="application/rss+xml" class="iconfont icon-rss" title="rss"></a>
</div>

<div class="copyright">
  <span class="power-by">
    由 <a class="hexo-link" href="https://gohugo.io">Hugo</a> 强力驱动
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    主题 - 
    <a class="theme-link" href="https://github.com/olOwOlo/hugo-theme-even">Even</a>
  </span>

  <div class="busuanzi-footer">
    <span id="busuanzi_container_site_pv"> 本站总访问量 <span id="busuanzi_value_site_pv"><img src="/img/spinner.svg" alt="spinner.svg"/></span> 次 </span>
      <span class="division">|</span>
    <span id="busuanzi_container_site_uv"> 本站总访客数 <span id="busuanzi_value_site_uv"><img src="/img/spinner.svg" alt="spinner.svg"/></span> 人 </span>
  </div>

  <span class="copyright-year">
    &copy; 
    2012 - 
    2023<span class="heart"><i class="iconfont icon-heart"></i></span><span>Solarex</span>
  </span>
</div>

    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont icon-up"></i>
    </div>
  </div>
  
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.2.1/dist/jquery.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/slideout@1.0.1/dist/slideout.min.js" integrity="sha256-t+zJ/g8/KXIJMjSVQdnibt4dlaDxc9zXr/9oNPeWqdg=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.js" integrity="sha256-XVLffZaxoWfGUEbdzuLi7pwaUJv1cecsQJQqGLe7axY=" crossorigin="anonymous"></script><script></script><script src="https://cdn.jsdelivr.net/npm/raphael@2.2.7/raphael.min.js" integrity="sha256-67By+NpOtm9ka1R6xpUefeGOY8kWWHHRAKlvaTJ7ONI=" crossorigin="anonymous"></script> <script src="https://cdn.jsdelivr.net/npm/flowchart.js@1.8.0/release/flowchart.min.js" integrity="sha256-zNGWjubXoY6rb5MnmpBNefO0RgoVYfle9p0tvOQM+6k=" crossorigin="anonymous"></script><script></script><script src="https://cdn.jsdelivr.net/npm/webfontloader@1.6.28/webfontloader.js" integrity="sha256-4O4pS1SH31ZqrSO2A/2QJTVjTPqVe+jnYgOWUVr7EEc=" crossorigin="anonymous"></script> <script src="https://cdn.jsdelivr.net/npm/snapsvg@0.5.1/dist/snap.svg-min.js" integrity="sha256-oI+elz+sIm+jpn8F/qEspKoKveTc5uKeFHNNVexe6d8=" crossorigin="anonymous"></script> <script src="https://cdn.jsdelivr.net/npm/underscore@1.8.3/underscore-min.js" integrity="sha256-obZACiHd7gkOk9iIL/pimWMTJ4W/pBsKu+oZnSeBIek=" crossorigin="anonymous"></script> <script src="https://cdn.jsdelivr.net/gh/bramp/js-sequence-diagrams@2.0.1/dist/sequence-diagram-min.js" integrity="sha384-8748Vn52gHJYJI0XEuPB2QlPVNUkJlJn9tHqKec6J3q2r9l8fvRxrgn/E5ZHV0sP" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/bramp/js-sequence-diagrams@2.0.1/dist/sequence-diagram-min.css" integrity="sha384-6QbLKJMz5dS3adWSeINZe74uSydBGFbnzaAYmp+tKyq60S7H2p6V7g1TysM5lAaF" crossorigin="anonymous">



<script type="text/javascript" src="/js/main.min.4ae89da218555efa0e7093a20b92017d2e1202b66fff9fc2edf4cb8d44b44c6e.js"></script>


<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'G-4L7CV05E75', 'auto');
	ga('set', 'anonymizeIp', true);
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>
<script id="baidu_analytics">
  var _hmt = _hmt || [];
  (function() {
    if (window.location.hostname === 'localhost') return;
    var hm = document.createElement("script"); hm.async = true;
    hm.src = "https://hm.baidu.com/hm.js?9689f78768a1999a6b08890d53ef1820";
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(hm, s);
  })();
</script>






</body>
</html>
