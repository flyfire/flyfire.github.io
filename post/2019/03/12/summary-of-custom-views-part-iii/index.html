<!DOCTYPE html>
<html lang="zh-cn">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>Summary of Custom Views Part Iii - Solarex&#39;s Blog</title>
  <meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">


<meta name="author" content="Solarex" /><meta name="description" content="自定义View总结 - 触摸反馈 之前分析了Android触摸事件分发机制，在自定义View的时候进行触摸反馈，一般都是重写onTouchEven" /><meta name="keywords" content="Android, Java, Kotlin" />






<meta name="generator" content="Hugo 0.110.0 with theme even" />


<link rel="canonical" href="https://flyfire.github.io/post/2019/03/12/summary-of-custom-views-part-iii/" />
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/manifest.json">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">

<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>

<link href="/sass/main.min.f92fd13721ddf72129410fd8250e73152cc6f2438082b6c0208dc24ee7c13fc4.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.css" integrity="sha256-7TyXnr2YU040zfSP+rEcz29ggW4j56/ujTPwjMzyqFY=" crossorigin="anonymous">


<meta property="og:title" content="Summary of Custom Views Part Iii" />
<meta property="og:description" content="自定义View总结 - 触摸反馈 之前分析了Android触摸事件分发机制，在自定义View的时候进行触摸反馈，一般都是重写onTouchEven" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://flyfire.github.io/post/2019/03/12/summary-of-custom-views-part-iii/" /><meta property="article:section" content="post" />
<meta property="article:published_time" content="2019-03-12T00:00:00+00:00" />
<meta property="article:modified_time" content="2019-03-12T00:00:00+00:00" />
<meta itemprop="name" content="Summary of Custom Views Part Iii">
<meta itemprop="description" content="自定义View总结 - 触摸反馈 之前分析了Android触摸事件分发机制，在自定义View的时候进行触摸反馈，一般都是重写onTouchEven"><meta itemprop="datePublished" content="2019-03-12T00:00:00+00:00" />
<meta itemprop="dateModified" content="2019-03-12T00:00:00+00:00" />
<meta itemprop="wordCount" content="3305">
<meta itemprop="keywords" content="" /><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Summary of Custom Views Part Iii"/>
<meta name="twitter:description" content="自定义View总结 - 触摸反馈 之前分析了Android触摸事件分发机制，在自定义View的时候进行触摸反馈，一般都是重写onTouchEven"/>

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->

</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/" class="logo">Solarex&#39;s Blog</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <a href="/">
        <li class="mobile-menu-item">Home</li>
      </a><a href="/post/">
        <li class="mobile-menu-item">Archives</li>
      </a><a href="/projects/">
        <li class="mobile-menu-item">Projects</li>
      </a><a href="/about/">
        <li class="mobile-menu-item">About</li>
      </a>
  </ul>

  


</nav>

  <div class="container" id="mobile-panel">
    <header id="header" class="header">
        <div class="logo-wrapper">
  <a href="/" class="logo">Solarex&#39;s Blog</a>
</div>





<nav class="site-navbar">
  <ul id="menu" class="menu">
    <li class="menu-item">
        <a class="menu-item-link" href="/">Home</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/post/">Archives</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/projects/">Projects</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/about/">About</a>
      </li>
  </ul>
</nav>

    </header>

    <main id="main" class="main">
      <div class="content-wrapper">
        <div id="content" class="content">
          <article class="post">
    
    <header class="post-header">
      <h1 class="post-title">Summary of Custom Views Part Iii</h1>

      <div class="post-meta">
        <span class="post-time"> 2019-03-12 </span>
        <div class="post-category">
            <a href="/categories/dev/"> dev </a>
            <a href="/categories/android/"> android </a>
            </div>
          <span class="more-meta"> 约 3305 字 </span>
          <span class="more-meta"> 预计阅读 7 分钟 </span>
        <span id="busuanzi_container_page_pv" class="more-meta"> <span id="busuanzi_value_page_pv"><img src="/img/spinner.svg" alt="spinner.svg"/></span> 次阅读 </span>
      </div>
    </header>

    <div class="post-toc" id="post-toc">
  <h2 class="post-toc-title">文章目录</h2>
  <div class="post-toc-content always-active">
    <nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#自定义view总结---触摸反馈">自定义View总结 - 触摸反馈</a>
          <ul>
            <li><a href="#viewconfiguration">ViewConfiguration</a></li>
            <li><a href="#scroller--overscroller">Scroller &amp; OverScroller</a></li>
            <li><a href="#velocitytracker">VelocityTracker</a></li>
            <li><a href="#gesturedetector--scalegesturedetector">GestureDetector &amp; ScaleGestureDetector</a></li>
            <li><a href="#viewdraghelper--viewondraglistener">ViewDragHelper &amp; View.OnDragListener</a></li>
          </ul>
        </li>
      </ul>
    </li>
  </ul>
</nav>
  </div>
</div>
    <div class="post-content">
      <h2 id="自定义view总结---触摸反馈">自定义View总结 - 触摸反馈</h2>
<p>之前分析了<a href="http://solarex.github.io/blog/2018/03/25/android-touch-system/">Android触摸事件分发机制</a>，在自定义View的时候进行触摸反馈，一般都是重写<code>onTouchEvent</code>，当然也有一些工具类可以使用，本文就对这些工具类进行总结，他们是<code>ViewConfiguration</code>，<code>Scroller</code>，<code>OverScroller</code>，<code>VelocityTracker</code>，<code>GestureDetector</code>，<code>ScaleGestureDetector</code>，<code>ViewDragHelper</code>。</p>
<!-- more -->
<h3 id="viewconfiguration">ViewConfiguration</h3>
<p><code>ViewConfiguration</code>定义了一些UI系统用用到的常量，包括timeouts,sizes,distances。timeouts比如<code>DEFAULT_LONG_PRESS_TIMEOUT</code>,<code>DOUBLE_TAP_TIMEOUT</code>等，sizes包括<code>SCROLL_BAR_SIZE</code>等，distances我们平时自定义View的时候可能用的比较多，常用的有<code>getScaledTouchSlop</code>来判断是否是滑动，<code>getScaledPagingTouchSlop</code>来判断是否是翻页滑动，自己写<code>ViewPager</code>的时候可以用到，<code>getScaledMaximumFlingVelocity</code>和<code>getMinimumFlingVelocity</code>来对惯性滑动进行判断处理。</p>
<h3 id="scroller--overscroller">Scroller &amp; OverScroller</h3>
<p><code>View</code>的<code>scrollTo</code>和<code>scrollBy</code>是瞬间完成的，如果需要<code>View</code>的滑动有个动画效果，说白了，就是View的位置移动有段时间间隔，可以使用<code>Scroller</code>或<code>OverScroller</code>来完成。<code>Scroller</code>本身无法让View滑动，它主要是个计算器，得配合View的<code>computeScroll</code>使用才能完成这个功能，或者不使用View的<code>computeScroll</code>，你自己写个<code>Runnable</code>，在<code>Runnable</code>里面进行<code>Scroller</code>计算完成的判断并调用View的<code>scrollTo</code>，然后再<code>postOnAnimation(this)</code>将自身传入再次调用即可。</p>
<p>使用<code>computeScroll</code>的样板代码如下：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">Scroller</span> <span class="n">scroller</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Scroller</span><span class="o">(</span><span class="n">context</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// 缓慢滚动到指定位置
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">private</span> <span class="kt">void</span> <span class="nf">smoothScrollTo</span><span class="o">(</span><span class="kt">int</span> <span class="n">destX</span><span class="o">,</span> <span class="kt">int</span> <span class="n">destY</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="kt">int</span> <span class="n">scrollx</span> <span class="o">=</span> <span class="n">getScrollX</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">    <span class="kt">int</span> <span class="n">dx</span> <span class="o">=</span> <span class="n">destX</span> <span class="o">-</span> <span class="n">scrollx</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">scroller</span><span class="o">.</span><span class="na">startScroll</span><span class="o">(</span><span class="n">scrollx</span><span class="o">,</span> <span class="mi">0</span><span class="o">,</span> <span class="n">dx</span><span class="o">,</span> <span class="mi">0</span><span class="o">,</span> <span class="mi">1000</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// 这步很重要，触发下面的 computeScroll
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">invalidate</span><span class="o">();</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nd">@Override</span>
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kt">void</span> <span class="nf">computeScroll</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span><span class="o">(</span><span class="n">scroller</span><span class="o">.</span><span class="na">computeScrollOffset</span><span class="o">())</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">scrollTo</span><span class="o">(</span><span class="n">scroller</span><span class="o">.</span><span class="na">getCurrX</span><span class="o">(),</span> <span class="n">scroller</span><span class="o">.</span><span class="na">getCurrY</span><span class="o">());</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// 这步继续触发 computeScroll，Scroller会更新x,y，View继续scrollTo新位置
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="n">postInvalidate</span><span class="o">();</span><span class="err">或者</span><span class="n">invalidate</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><code>OverScroller</code>的<code>startScroll</code>，<code>fling</code>方法和<code>Scroller</code>类似，不再赘述，除此之外<code>OverScroller</code>还有一个带over参数的<code>fling</code>函数<code>public void fling(int startX, int startY, int velocityX, int velocityY, int minX, int maxX, int minY, int maxY, int overX, int overY)</code>可以滑动超出View的边界。</p>
<h3 id="velocitytracker">VelocityTracker</h3>
<p>速度追踪，用于追踪手指在滑动过程中的速度，包括水平和垂直方向的速度，一般配合<code>Scroller</code>的<code>fling</code>使用。它的使用过程很简单，首先，在View的<code>onTouchEvent</code>方法中追踪当前单击事件的速度：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="c1">// onTouchEvent
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">VelocityTracker</span> <span class="n">velocityTracker</span> <span class="o">=</span> <span class="n">VelocityTracker</span><span class="o">.</span><span class="na">obtain</span><span class="o">();</span>
</span></span><span class="line"><span class="cl"><span class="n">velocityTracker</span><span class="o">.</span><span class="na">addMovement</span><span class="o">(</span><span class="n">event</span><span class="o">);</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>接着，在手指抬起，也就是<code>ACTION_UP</code>的时候，获取速度：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="c1">// onTouchEvent ACTION_UP
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">velocityTracker</span><span class="o">.</span><span class="na">computeCurrentVelocity</span><span class="o">(</span><span class="mi">1000</span><span class="o">);</span>
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="n">xVel</span> <span class="o">=</span> <span class="o">(</span><span class="kt">int</span><span class="o">)</span> <span class="n">velocityTracker</span><span class="o">.</span><span class="na">getXVelocity</span><span class="o">();</span>
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="n">yVel</span> <span class="o">=</span> <span class="o">(</span><span class="kt">int</span><span class="o">)</span> <span class="n">velocityTracker</span><span class="o">.</span><span class="na">getYVelocity</span><span class="o">();</span>
</span></span><span class="line"><span class="cl"><span class="cm">/* do something like fling */</span>
</span></span><span class="line"><span class="cl"><span class="n">velocityTracker</span><span class="o">.</span><span class="na">clear</span><span class="o">();</span>
</span></span><span class="line"><span class="cl"><span class="n">velocityTracker</span><span class="o">.</span><span class="na">recycle</span><span class="o">();</span> <span class="c1">// 重置并回收
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>速度的计算公式是<code>速度=(终点位置 - 起点位置)/时间段</code>，所以逆着手机坐标系的正方向滑动，所产生的速度为负值。另外记得要重置并回收<code>VelocityTracker</code>。</p>
<h3 id="gesturedetector--scalegesturedetector">GestureDetector &amp; ScaleGestureDetector</h3>
<p><code>GestureDetector</code>手势检测，用于辅助检测用户的单击、滑动、长按、双击等行为。<code>ScaleGestureDetector</code>主要是双指或多指的pinch zoom放大缩小行为。要使用<code>GestureDetector</code>也很简单，参考如下过程。</p>
<p>首先，创建<code>GestureDetector</code>对象并实现<code>GestureDetector.OnGestureListener</code>接口，根据需要也可以实现<code>GestureDetector.OnDoubleTapListener</code>接口或者<code>GestureDetector.OnContextClickListener</code>接口，或者使用<code>SimpleOnGestureListener</code>来在自己感兴趣的方法中做处理。</p>
<table>
<thead>
<tr>
<th style="text-align:center">方法名</th>
<th style="text-align:center">描述</th>
<th style="text-align:center">所属接口</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">onDown</td>
<td style="text-align:center">手指轻触屏幕，由1个<code>ACTION_DOWN</code>触发</td>
<td style="text-align:center">OnGestureListener</td>
</tr>
<tr>
<td style="text-align:center">onShowPress</td>
<td style="text-align:center">手指轻触屏幕，尚未松开或拖动，由1个<code>ACTION_DOWN</code>触发</td>
<td style="text-align:center">OnGestureListener</td>
</tr>
<tr>
<td style="text-align:center">onSingleTapUp</td>
<td style="text-align:center">手指轻触屏幕后松开，随着<code>ACTION_UP</code>触发，这是单击行为</td>
<td style="text-align:center">OnGestureListener</td>
</tr>
<tr>
<td style="text-align:center">onScroll</td>
<td style="text-align:center">手指按下屏幕并拖动，由1个<code>ACTION_DOWN</code>及多个<code>ACTION_MOVE</code>触发，这是拖动行为</td>
<td style="text-align:center">OnGestureListener</td>
</tr>
<tr>
<td style="text-align:center">onLongPress</td>
<td style="text-align:center">长按</td>
<td style="text-align:center">OnGestureListener</td>
</tr>
<tr>
<td style="text-align:center">onFling</td>
<td style="text-align:center">按下屏幕快速滑动后松开，由1个<code>ACTION_DOWN</code>多个<code>ACTION_MOVE</code>和1个<code>ACTION_UP</code>触发，快速滑动</td>
<td style="text-align:center">OnGestureListener</td>
</tr>
<tr>
<td style="text-align:center">onDoubleTap</td>
<td style="text-align:center">双击，由2次连续的单击组成，不可能和onSingleTapConfirmed共存</td>
<td style="text-align:center">OnDoubleTapListener</td>
</tr>
<tr>
<td style="text-align:center">onSingleTapConfirmed</td>
<td style="text-align:center">严格的单击行为</td>
<td style="text-align:center">OnDoubleTapListener</td>
</tr>
<tr>
<td style="text-align:center">onDoubleTapEvent</td>
<td style="text-align:center">发生了双击行为，在双击期间，<code>ACTION_DOWN</code>、<code>ACTION_MOVE</code>、<code>ACTION_UP</code>都会触发此回调</td>
<td style="text-align:center">OnDoubleTapListener</td>
</tr>
</tbody>
</table>
<p>接着，接管目标View的<code>onTouchEvent</code>方法</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="c1">// onTouchEvent
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kt">boolean</span> <span class="n">consume</span> <span class="o">=</span> <span class="n">mGestureDetector</span><span class="o">.</span><span class="na">onTouchEvent</span><span class="o">(</span><span class="n">event</span><span class="o">);</span>
</span></span><span class="line"><span class="cl"><span class="k">return</span> <span class="n">consume</span><span class="o">;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>事件经过判断后就会回调我们实现的listener中的方法。如果只是监听滑动相关的可以自己在<code>onTouchEvent</code>方法的<code>ACTION_MOVE</code>中调用<code>View</code>的<code>scrollTo(x,y)</code>来实现View的滑动，如果是监听双击这种行为的话，就使用<code>GestureDetector</code>。</p>
<p><code>ScaleGestureDetector</code>是处理放大缩小手势的，使用和<code>GestureDetector</code>类似。</p>
<table>
<thead>
<tr>
<th style="text-align:center">方法名</th>
<th style="text-align:center">描述</th>
<th style="text-align:center">所属接口</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">public boolean onScale(ScaleGestureDetector detector);</td>
<td style="text-align:center">通过调用detector.getScaleFactor来获得放大的系数，来进行进一步处理，比如对ImageView的Matrix进行操作等等，返回值代表事件有没有被消费</td>
<td style="text-align:center">OnScaleGestureListener</td>
</tr>
<tr>
<td style="text-align:center">public boolean onScaleBegin(ScaleGestureDetector detector);</td>
<td style="text-align:center">如果要检测放大缩小手势，返回true，类似于<code>ACTION_DOWN</code>对事件感兴趣返回true</td>
<td style="text-align:center">OnScaleGestureListener</td>
</tr>
<tr>
<td style="text-align:center">public void onScaleEnd(ScaleGestureDetector detector);</td>
<td style="text-align:center">放大或缩小结束，可以调用detector.getFocusX()或detector.getFocusY()来获取焦点</td>
<td style="text-align:center">OnScaleGestureListener</td>
</tr>
</tbody>
</table>
<h3 id="viewdraghelper--viewondraglistener">ViewDragHelper &amp; View.OnDragListener</h3>
<p><code>ViewDragHelper</code>可以实现各种不同的滑动、拖放需求，使用参考如下过程。<code>ViewDragHelper</code>一般在自定义<code>ViewGroup</code>中使用。</p>
<p>首先，初始化<code>ViewDragHelper</code>，实现<code>ViewDragHelper.Callback</code>。<code>mViewDragHelper = ViewDragHelper.create(viewgroup, callback);</code></p>
<p>然后，接管ViewGroup的事件处理，样板代码如下：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@Override</span>
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">onInterceptTouchEvent</span><span class="o">(</span><span class="n">MotionEvent</span> <span class="n">ev</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">mViewDragHelper</span><span class="o">.</span><span class="na">shouldInterceptTouchEvent</span><span class="o">(</span><span class="n">ev</span><span class="o">);</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nd">@Override</span>
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">onTouchEvent</span><span class="o">(</span><span class="n">MotionEvent</span> <span class="n">ev</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">mViewDragHelper</span><span class="o">.</span><span class="na">processTouchEvent</span><span class="o">(</span><span class="n">ev</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>接着，处理<code>computeScroll</code>，<code>ViewDragHelper</code>内部也是通过<code>Scroller</code>来实现平滑移动的，样板代码如下：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@Override</span>
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kt">void</span> <span class="nf">computeScroll</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span><span class="o">(</span><span class="n">mViewDragHelper</span><span class="o">.</span><span class="na">continueSettling</span><span class="o">(</span><span class="kc">true</span><span class="o">))</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">ViewCompat</span><span class="o">.</span><span class="na">postInvalidateOnAnimation</span><span class="o">(</span><span class="k">this</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><table>
<thead>
<tr>
<th style="text-align:center">方法名</th>
<th style="text-align:center">描述</th>
<th style="text-align:center">所属接口</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">public abstract boolean tryCaptureView(View child, int pointerId);</td>
<td style="text-align:center">哪个子View可以被拖动就返回true</td>
<td style="text-align:center">ViewDragHelper.Callback</td>
</tr>
<tr>
<td style="text-align:center">public int clampViewPositionVertical(View child, int top, int dy) {     return 0; }</td>
<td style="text-align:center">限制被捕捉的View垂直方向上活动的范围</td>
<td style="text-align:center">ViewDragHelper.Callback</td>
</tr>
<tr>
<td style="text-align:center">public int clampViewPositionHorizontal(View child, int left, int dx) {     return 0; }</td>
<td style="text-align:center">限制被捕捉View水平方向上活动的范围</td>
<td style="text-align:center">ViewDragHelper.Callback</td>
</tr>
<tr>
<td style="text-align:center">public void onViewCaptured(View capturedChild, int activePointerId) {}</td>
<td style="text-align:center">View被捕捉的时候被调用</td>
<td style="text-align:center">ViewDragHelper.Callback</td>
</tr>
<tr>
<td style="text-align:center">public void onViewPositionChanged(View changedView, int left, int top, int dx, int dy) {}</td>
<td style="text-align:center">被捕捉的View位置发生变化时调用</td>
<td style="text-align:center">ViewDragHelper.Callback</td>
</tr>
<tr>
<td style="text-align:center">public void onViewDragStateChanged(int state) {}</td>
<td style="text-align:center">drag state变化时调用，STATE_IDLE，STATE_DRAGGING，STATE_SETTLING</td>
<td style="text-align:center">ViewDragHelper.Callback</td>
</tr>
<tr>
<td style="text-align:center">public void onViewReleased(View releasedChild, float xvel, float yvel) {}</td>
<td style="text-align:center">View被松开时调用</td>
<td style="text-align:center">ViewDragHelper.Callback</td>
</tr>
<tr>
<td style="text-align:center">public void onEdgeTouched(int edgeFlags, int pointerId) {}</td>
<td style="text-align:center">没有View被捕捉，父View的边缘被touch到</td>
<td style="text-align:center">ViewDragHelper.Callback</td>
</tr>
<tr>
<td style="text-align:center">public boolean onEdgeLock(int edgeFlags) {     return false; }</td>
<td style="text-align:center"></td>
<td style="text-align:center">ViewDragHelper.Callback</td>
</tr>
<tr>
<td style="text-align:center">public void onEdgeDragStarted(int edgeFlags, int pointerId) {}</td>
<td style="text-align:center"></td>
<td style="text-align:center">ViewDragHelper.Callback</td>
</tr>
<tr>
<td style="text-align:center">public int getOrderedChildIndex(int index) {     return index; }</td>
<td style="text-align:center"></td>
<td style="text-align:center">ViewDragHelper.Callback</td>
</tr>
<tr>
<td style="text-align:center">public int getViewHorizontalDragRange(View child) {     return 0; }</td>
<td style="text-align:center"></td>
<td style="text-align:center">ViewDragHelper.Callback</td>
</tr>
<tr>
<td style="text-align:center">public int getViewVerticalDragRange(View child) {     return 0; }</td>
<td style="text-align:center"></td>
<td style="text-align:center">ViewDragHelper.Callback</td>
</tr>
</tbody>
</table>
<p><code>View.OnDragListener</code>只有一个方法<code>boolean onDrag(View v, DragEvent event);</code>，当拖拽事件被分发到View时调用。<code>DragEvent</code>有几个状态可以在其中做处理<code>ACTION_DRAG_STARTED</code>，<code>ACTION_DRAG_ENDED</code>，<code>ACTION_DRAG_ENTERED</code>，<code>ACTION_DRAG_EXITED</code>。View开始拖动可以调用<code>ViewCompat.startDragAndDrop(@NonNull View v, ClipData data,View.DragShadowBuilder shadowBuilder, Object localState, int flags)</code>来开始拖动，这样会在View上方出现一个Shadow来表示被拖动的View。</p>

    </div>

    <div class="post-copyright">
  <p class="copyright-item">
    <span class="item-title">文章作者</span>
    <span class="item-content">Solarex</span>
  </p>
  <p class="copyright-item">
    <span class="item-title">上次更新</span>
    <span class="item-content">
        2019-03-12
        
    </span>
  </p>
  
  <p class="copyright-item">
    <span class="item-title">许可协议</span>
    <span class="item-content"><a rel="license noopener" href="https://creativecommons.org/licenses/by-nc-nd/4.0/" targ    et="_blank">CC BY-NC-ND 4.0</a></span>
  </p>
</div>
<div class="post-reward">
  <input type="checkbox" name="reward" id="reward" hidden />
  <label class="reward-button" for="reward">赞赏支持</label>
  <div class="qr-code">
    
    <label class="qr-code-image" for="reward">
        <img class="image" src="/images/wechatpay.png">
        <span>微信打赏</span>
      </label>
    <label class="qr-code-image" for="reward">
        <img class="image" src="/images/alipay.png">
        <span>支付宝打赏</span>
      </label>
  </div>
</div><footer class="post-footer">
      
      <nav class="post-nav">
        <a class="prev" href="/post/2019/04/18/how-kotlin-generate-method-default-arguments/">
            <i class="iconfont icon-left"></i>
            <span class="prev-text nav-default">How Kotlin Generate Method Default Arguments</span>
            <span class="prev-text nav-mobile">上一篇</span>
          </a>
        <a class="next" href="/post/2019/02/12/summary-of-custom-views-part-ii/">
            <span class="next-text nav-default">Summary of Custom Views Part Ii</span>
            <span class="next-text nav-mobile">下一篇</span>
            <i class="iconfont icon-right"></i>
          </a>
      </nav>
    </footer>
  </article>
        </div>
        <div id="disqus_thread"></div>
    <script type="text/javascript">
    (function() {
      
      
      if (window.location.hostname === 'localhost') return;

      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      var disqus_shortname = 'solarex-blog';
      dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>

  

  

      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="social-links">
      <a href="mailto:rh.hou.work@email.com" class="iconfont icon-email" title="email"></a>
      <a href="https://stackoverflow.com/users/2573305/user2573305" class="iconfont icon-stack-overflow" title="stack-overflow"></a>
      <a href="https://twitter.com/solarexcn" class="iconfont icon-twitter" title="twitter"></a>
      <a href="https://github.com/flyfire" class="iconfont icon-github" title="github"></a>
      <a href="https://weibo.com/solarex" class="iconfont icon-weibo" title="weibo"></a>
      <a href="https://www.zhihu.com/people/solarex" class="iconfont icon-zhihu" title="zhihu"></a>
      <a href="https://space.bilibili.com/8934511" class="iconfont icon-bilibili" title="bilibili"></a>
      <a href="https://www.douban.com/people/solarexh/" class="iconfont icon-douban" title="douban"></a>
  <a href="https://flyfire.github.io/index.xml" type="application/rss+xml" class="iconfont icon-rss" title="rss"></a>
</div>

<div class="copyright">
  <span class="power-by">
    由 <a class="hexo-link" href="https://gohugo.io">Hugo</a> 强力驱动
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    主题 - 
    <a class="theme-link" href="https://github.com/olOwOlo/hugo-theme-even">Even</a>
  </span>

  <div class="busuanzi-footer">
    <span id="busuanzi_container_site_pv"> 本站总访问量 <span id="busuanzi_value_site_pv"><img src="/img/spinner.svg" alt="spinner.svg"/></span> 次 </span>
      <span class="division">|</span>
    <span id="busuanzi_container_site_uv"> 本站总访客数 <span id="busuanzi_value_site_uv"><img src="/img/spinner.svg" alt="spinner.svg"/></span> 人 </span>
  </div>

  <span class="copyright-year">
    &copy; 
    2012 - 
    2023<span class="heart"><i class="iconfont icon-heart"></i></span><span>Solarex</span>
  </span>
</div>

    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont icon-up"></i>
    </div>
  </div>
  
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.2.1/dist/jquery.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/slideout@1.0.1/dist/slideout.min.js" integrity="sha256-t+zJ/g8/KXIJMjSVQdnibt4dlaDxc9zXr/9oNPeWqdg=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.js" integrity="sha256-XVLffZaxoWfGUEbdzuLi7pwaUJv1cecsQJQqGLe7axY=" crossorigin="anonymous"></script><script></script><script src="https://cdn.jsdelivr.net/npm/raphael@2.2.7/raphael.min.js" integrity="sha256-67By+NpOtm9ka1R6xpUefeGOY8kWWHHRAKlvaTJ7ONI=" crossorigin="anonymous"></script> <script src="https://cdn.jsdelivr.net/npm/flowchart.js@1.8.0/release/flowchart.min.js" integrity="sha256-zNGWjubXoY6rb5MnmpBNefO0RgoVYfle9p0tvOQM+6k=" crossorigin="anonymous"></script><script></script><script src="https://cdn.jsdelivr.net/npm/webfontloader@1.6.28/webfontloader.js" integrity="sha256-4O4pS1SH31ZqrSO2A/2QJTVjTPqVe+jnYgOWUVr7EEc=" crossorigin="anonymous"></script> <script src="https://cdn.jsdelivr.net/npm/snapsvg@0.5.1/dist/snap.svg-min.js" integrity="sha256-oI+elz+sIm+jpn8F/qEspKoKveTc5uKeFHNNVexe6d8=" crossorigin="anonymous"></script> <script src="https://cdn.jsdelivr.net/npm/underscore@1.8.3/underscore-min.js" integrity="sha256-obZACiHd7gkOk9iIL/pimWMTJ4W/pBsKu+oZnSeBIek=" crossorigin="anonymous"></script> <script src="https://cdn.jsdelivr.net/gh/bramp/js-sequence-diagrams@2.0.1/dist/sequence-diagram-min.js" integrity="sha384-8748Vn52gHJYJI0XEuPB2QlPVNUkJlJn9tHqKec6J3q2r9l8fvRxrgn/E5ZHV0sP" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/bramp/js-sequence-diagrams@2.0.1/dist/sequence-diagram-min.css" integrity="sha384-6QbLKJMz5dS3adWSeINZe74uSydBGFbnzaAYmp+tKyq60S7H2p6V7g1TysM5lAaF" crossorigin="anonymous">



<script type="text/javascript" src="/js/main.min.4ae89da218555efa0e7093a20b92017d2e1202b66fff9fc2edf4cb8d44b44c6e.js"></script>


<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'G-4L7CV05E75', 'auto');
	ga('set', 'anonymizeIp', true);
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>
<script id="baidu_analytics">
  var _hmt = _hmt || [];
  (function() {
    if (window.location.hostname === 'localhost') return;
    var hm = document.createElement("script"); hm.async = true;
    hm.src = "https://hm.baidu.com/hm.js?9689f78768a1999a6b08890d53ef1820";
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(hm, s);
  })();
</script>






</body>
</html>
